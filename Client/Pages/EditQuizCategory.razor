@page "/editquizcategory"
@using Tool.Shared;
@inject HttpClient _httpClient
@inject NavigationManager NavigationManager
@inject IJSRuntime JsRuntime
<PageTitle>EditQuizCategory</PageTitle>

<div class="master p-4">
    <br />
    <br />
    <div class="center">
        <div class="Quiz-name form-input">
            <label for="quiz-category">Quiz Category Name :</label>
        </div>
        @if (questionList != null)
        {
            <table class="master-table table table-striped table-borderless">
                <thead>
                    <tr class="master-head">
                        <th class="master-head QuestionNo"><b>Question #</b> </th>
                        <th class="master-head QuestionText"><b>Question Text</b></th>
                        <th class="master-head Questionoption"><b>Available Options</b></th>
                        <th class="master-head Questionoption"><b>Correct Option</b></th>
                        <th class="master-head QuestionNo"><b>Action</b></th>
                    </tr>
                </thead>
                <tbody class="master-table3">
                    @foreach (var (q, index) in questionList.Select((q, index) => (q, index + 1)))
                    {
                        <tr class="master-row">
                            <td class="master-tablebody">@index</td>
                            <td class="master-tablebody">@q.QuestionText</td>
                            <td class="master-tablebody">@q.OptionOne, @q.OptionTwo, @q.OptionThree, @q.OptionFour</td>
                            <td class="master-tablebody"></td>
                            <td class="master-tablebody">
                                <a href="/editquestion/@q.QuestionQuizId" class="btn"><i class="fa fa-edit"></i></a>
                                <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#deleteQuestionDialog" @onclick="(e) => { questionIdToDelete = q.QuestionQuizId; }"><i class="fa-regular fa-trash-can"></i></button>
                              
                                @*Delete Dialoge Box*@

                                <div class="modal fade " id="deleteQuestionDialog" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <h5>Do you want to delete question number @index ?</h5>
                                                <br><br>
                                                <button type="button" class="action-btn" data-bs-dismiss="modal">Cancel</button>
                                                <button type="button" class="action-btn active" @onclick="Delete">Delete</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
    </div>
@code{
    List<QuestionViewModel> questionList = new List<QuestionViewModel>();
    int questionNumber;
    int questionIdToDelete;

    protected override async Task OnInitializedAsync()
    {
        var response = await _httpClient.GetAsync("api/Question");
        response.EnsureSuccessStatusCode();
        questionList = await response.Content.ReadFromJsonAsync<List<QuestionViewModel>>();
    }

    void ShowDeleteDialog(int questionNumberToDelete, int questionId)
    {
        questionNumber = questionNumberToDelete;
        questionIdToDelete = questionId;
        JsRuntime.InvokeVoidAsync("$('#deleteQuestionDialog').modal('show');");
    }

    protected async Task Delete()
    {
        var response = await _httpClient.DeleteAsync($"api/Question/{questionIdToDelete}");
        response.EnsureSuccessStatusCode();
        questionList.RemoveAll(q => q.QuestionQuizId == questionIdToDelete);
        JsRuntime.InvokeVoidAsync("$('#deleteQuestionDialog').modal('hide');");
    }

    void CancelDelete()
    {
        JsRuntime.InvokeVoidAsync("$('#deleteQuestionDialog').modal('hide');");
    }
}